function epsilon = molarextcoef_hemo(varargin) %#ok<*STOUT>
% EPSILON = MOLAREXTCOEF_HEMO
%
% Molar extinction coefficients for oxygenated and deoxygenated hemoglobin
%
% epsilon:
% - lambda (nm)
% - Hb02  [1/(cm*M)]
% - Hb [1/(cm*M)]
%
% MOLAREXTCOEF('PARAM1',val1) specifies optional
% name/value pairs. Parameters are:
%	'data'		- can be 'default','gratzer','moaveni','takatani' (default
%	= default). The data-set returned are from these people.
%
%	'display'	- display graph. Choices are:
%					0	- no graph (default)
%					>0	- graph
% 
% Source: ???
%
% See also: MBLL

% Optional display arguments
disp         = keyval('display',varargin,true);
dataset      = keyval('data',varargin,'default');

eval(['epsilon = ' dataset]);

if disp
	graph(epsilon)
end

function epsilon = default %#ok<*DEFNU>
epsilon = [650	0.3869	3.7351 ...
	;651	0.3793	3.7039 ...
	;652	0.3722	3.6727 ...
	;653	0.3659	3.6414 ...
	;654	0.3601	3.6126 ...
	;655	0.3545	3.5841 ...
	;656	0.3495	3.5555 ...
	;657	0.3451	3.5269 ...
	;658	0.341	3.4982 ...
	;659	0.3376	3.4695 ...
	;660	0.3346	3.4408 ...
	;661	0.3318	3.4062 ...
	;662	0.3294	3.3717 ...
	;663	0.3276	3.3371 ...
	;664	0.326	3.299 ...
	;665	0.3245	3.2582 ...
	;666	0.3234	3.2174 ...
	;667	0.3227	3.1762 ...
	;668	0.322	3.1327 ...
	;669	0.3216	3.0891 ...
	;670	0.3213	3.0455 ...
	;671	0.3212	2.9993 ...
	;672	0.3212	2.9519 ...
	;673	0.3214	2.9045 ...
	;674	0.3214	2.8569 ...
	;675	0.3211	2.8087 ...
	;676	0.3208	2.7606 ...
	;677	0.3206	2.7124 ...
	;678	0.3205	2.6652 ...
	;679	0.3201	2.6183 ...
	;680	0.3194	2.5713 ...
	;681	0.3186	2.5248 ...
	;682	0.3181	2.4788 ...
	;683	0.3173	2.4329 ...
	;684	0.3163	2.387 ...
	;685	0.3157	2.3436 ...
	;686	0.3151	2.3004 ...
	;687	0.314	2.2572 ...
	;688	0.3135	2.2162 ...
	;689	0.3126	2.1772 ...
	;690	0.3123	2.1382 ...
	;691	0.3122	2.0997 ...
	;692	0.3122	2.0656 ...
	;693	0.3123	2.0315 ...
	;694	0.3125	1.9974 ...
	;695	0.313	1.9665 ...
	;696	0.314	1.937 ...
	;697	0.3148	1.9076 ...
	;698	0.3164	1.8791 ...
	;699	0.3181	1.853 ...
	;700	0.3199	1.827 ...
	;701	0.3219	1.801 ...
	;702	0.3243	1.7777 ...
	;703	0.3269	1.7548 ...
	;704	0.3296	1.7319 ...
	;705	0.3323	1.7099 ...
	;706	0.3352	1.6887 ...
	;707	0.3386	1.6675 ...
	;708	0.3418	1.6464 ...
	;709	0.345	1.6267 ...
	;710	0.3485	1.607 ...
	;711	0.3524	1.5873 ...
	;712	0.3564	1.5677 ...
	;713	0.3602	1.5481 ...
	;714	0.3639	1.5285 ...
	;715	0.368	1.5093 ...
	;716	0.3724	1.4907 ...
	;717	0.3765	1.4721 ...
	;718	0.3807	1.4535 ...
	;719	0.3854	1.4365 ...
	;720	0.3899	1.4197 ...
	;721	0.3943	1.4029 ...
	;722	0.3988	1.3875 ...
	;723	0.4035	1.3733 ...
	;724	0.4083	1.3592 ...
	;725	0.4133	1.3456 ...
	;726	0.4181	1.3352 ...
	;727	0.423	1.3249 ...
	;728	0.4281	1.3146 ...
	;729	0.4332	1.3081 ...
	;730	0.4383	1.3029 ...
	;731	0.4435	1.2976 ...
	;732	0.4488	1.2946 ...
	;733	0.454	1.295 ...
	;734	0.4593	1.2953 ...
	;735	0.4646	1.2959 ...
	;736	0.47	1.3028 ...
	;737	0.4754	1.3096 ...
	;738	0.4811	1.3164 ...
	;739	0.4863	1.3277 ...
	;740	0.492	1.3411 ...
	;741	0.4976	1.3545 ...
	;742	0.5032	1.3697 ...
	;743	0.5089	1.3887 ...
	;744	0.5147	1.4078 ...
	;745	0.5203	1.4268 ...
	;746	0.5259	1.4501 ...
	;747	0.5317	1.4736 ...
	;748	0.5376	1.4971 ...
	;749	0.5436	1.5212 ...
	;750	0.5495	1.5458 ...
	;751	0.5554	1.5703 ...
	;752	0.5613	1.5938 ...
	;753	0.5672	1.6142 ...
	;754	0.5731	1.6346 ...
	;755	0.5791	1.6549 ...
	;756	0.5856	1.6646 ...
	;757	0.5912	1.6733 ...
	;758	0.5974	1.682 ...
	;759	0.6031	1.6816 ...
	;760	0.6096	1.6745 ...
	;761	0.6157	1.6674 ...
	;762	0.6219	1.6566 ...
	;763	0.6283	1.6343 ...
	;764	0.6345	1.6121 ...
	;765	0.6407	1.5898 ...
	;766	0.6469	1.5582 ...
	;767	0.6535	1.5259 ...
	;768	0.6596	1.4935 ...
	;769	0.6658	1.459 ...
	;770	0.672	1.4229 ...
	;771	0.6785	1.3869 ...
	;772	0.6849	1.3513 ...
	;773	0.6911	1.3169 ...
	;774	0.6974	1.2825 ...
	;775	0.7038	1.2481 ...
	;776	0.7101	1.2175 ...
	;777	0.7166	1.187 ...
	;778	0.7229	1.1566 ...
	;779	0.7297	1.1298 ...
	;780	0.736	1.105 ...
	;781	0.7422	1.0803 ...
	;782	0.7485	1.0571 ...
	;783	0.7549	1.0372 ...
	;784	0.7613	1.0173 ...
	;785	0.7681	0.9975 ...
	;786	0.7743	0.9822 ...
	;787	0.7808	0.9668 ...
	;788	0.7874	0.9515 ...
	;789	0.7941	0.9385 ...
	;790	0.8005	0.9264 ...
	;791	0.807	0.9143 ...
	;792	0.8134	0.9034 ...
	;793	0.8197	0.8939 ...
	;794	0.8264	0.8844 ...
	;795	0.833	0.8752 ...
	;796	0.8392	0.8676 ...
	;797	0.8458	0.86 ...
	;798	0.8524	0.8524 ...
	;799	0.8588	0.8461 ...
	;800	0.8653	0.8399 ...
	;801	0.8716	0.8338 ...
	;802	0.878	0.8285 ...
	;803	0.8845	0.8237 ...
	;804	0.8909	0.819 ...
	;805	0.8973	0.8146 ...
	;806	0.9038	0.8111 ...
	;807	0.9102	0.8075 ...
	;808	0.9164	0.804 ...
	;809	0.9227	0.8014 ...
	;810	0.9291	0.7987 ...
	;811	0.9354	0.7961 ...
	;812	0.9416	0.7941 ...
	;813	0.9478	0.7922 ...
	;814	0.9539	0.7904 ...
	;815	0.9603	0.7888 ...
	;816	0.9666	0.7874 ...
	;817	0.9728	0.7861 ...
	;818	0.9789	0.7849 ...
	;819	0.9848	0.7842 ...
	;820	0.9911	0.7834 ...
	;821	0.9973	0.7827 ...
	;822	1.0032	0.7822 ...
	;823	1.0091	0.7817 ...
	;824	1.0153	0.7812 ...
	;825	1.0211	0.7809 ...
	;826	1.0273	0.7808 ...
	;827	1.0333	0.7806 ...
	;828	1.0393	0.7805 ...
	;829	1.0449	0.7804 ...
	;830	1.0507	0.7804 ...
	;831	1.0564	0.7804 ...
	;832	1.0621	0.7804 ...
	;833	1.068	0.7804 ...
	;834	1.0739	0.7805 ...
	;835	1.0797	0.7805 ...
	;836	1.0851	0.7806 ...
	;837	1.0907	0.7807 ...
	;838	1.0962	0.7809 ...
	;839	1.1018	0.7812 ...
	;840	1.1072	0.7815 ...
	;841	1.1128	0.7817 ...
	;842	1.1182	0.782 ...
	;843	1.1233	0.7823 ...
	;844	1.1286	0.7827 ...
	;845	1.1339	0.7833 ...
	;846	1.1391	0.7839 ...
	;847	1.1442	0.7845 ...
	;848	1.1494	0.785 ...
	;849	1.1547	0.7856 ...
	;850	1.1596	0.7861 ...
	;851	1.1645	0.7871 ...
	;852	1.1694	0.788 ...
	;853	1.1742	0.789 ...
	;854	1.179	0.7901 ...
	;855	1.1842	0.7912 ...
	;856	1.1885	0.7923 ...
	;857	1.1934	0.7935 ...
	;858	1.198	0.7949 ...
	;859	1.2026	0.7963 ...
	;860	1.2071	0.7977 ...
	;861	1.2114	0.7993 ...
	;862	1.2156	0.8009 ...
	;863	1.22	0.8025 ...
	;864	1.2245	0.8044 ...
	;865	1.2286	0.8063 ...
	;866	1.2325	0.8082 ...
	;867	1.2367	0.8102 ...
	;868	1.2407	0.8122 ...
	;869	1.2449	0.8143 ...
	;870	1.249	0.8166 ...
	;871	1.2529	0.8189 ...
	;872	1.2565	0.8123 ...
	;873	1.2601	0.8237 ...
	;874	1.2641	0.8261 ...
	;875	1.2678	0.8285 ...
	;876	1.271	0.831 ...
	;877	1.2746	0.8336 ...
	;878	1.2781	0.8361 ...
	;879	1.2814	0.8387 ...
	;880	1.2846	0.8412 ...
	;881	1.2878	0.8438 ...
	;882	1.2907	0.8463 ...
	;883	1.2938	0.8489 ...
	;884	1.2971	0.8561 ...
	;885	1.3	0.8542 ...
	;886	1.3027	0.8568 ...
	;887	1.3058	0.8594 ...
	;888	1.3084	0.862 ...
	;889	1.3108	0.8645 ...
	;890	1.3137	0.867 ...
	;891	1.3165	0.8694 ...
	;892	1.3189	0.8718 ...
	;893	1.321	0.8742 ...
	;894	1.3235	0.8765 ...
	;895	1.3262	0.8787 ...
	;896	1.3283	0.8807 ...
	;897	1.3304	0.8827 ...
	;898	1.3323	0.8846 ...
	;899	1.3341	0.8863 ...
	;900	1.3365	0.888];

epsilon(:,2:3) = epsilon(:,2:3)*1000;

function epsilon = gratzer
%% From:
% https://omlc.org/spectra/hemoglobin/summary.html
% W. B. Gratzer, Med. Res. Council Labs, Holly Hill, London
% N. Kollias, Wellman Laboratories, Harvard Medical School, Boston

% lambda	Hb02	Hb
% nm	cm-1/M	cm-1/M
epsilon = [
250	106112	112736
252	105552	112736
254	107660	112736
256	109788	113824
258	112944	115040
260	116376	116296
262	120188	117564
264	124412	118876
266	128696	120208
268	133064	121544
270	136068	122880
272	137232	123096
274	138408	121952
276	137424	120808
278	135820	119840
280	131936	118872
282	127720	117628
284	122280	114820
286	116508	112008
288	108484	107140
290	104752	98364
292	98936	91636
294	88136	85820
296	79316	77100
298	70884	69444
300	65972	64440
302	63208	61300
304	61952	58828
306	62352	56908
308	62856	57620
310	63352	59156
312	65972	62248
314	69016	65344
316	72404	68312
318	75536	71208
320	78752	74508
322	82256	78284
324	85972	82060
326	89796	85592
328	93768	88516
330	97512	90856
332	100964	93192
334	103504	95532
336	104968	99792
338	106452	104476
340	107884	108472
342	109060	110996
344	110092	113524
346	109032	116052
348	107984	118752
350	106576	122092
352	105040	125436
354	103696	128776
356	101568	132120
358	97828	133632
360	94744	134940
362	92248	136044
364	89836	136972
366	88484	137900
368	87512	138856
370	88176	139968
372	91592	141084
374	95140	142196
376	98936	143312
378	103432	144424
380	109564	145232
382	116968	145232
384	125420	148668
386	135132	153908
388	148100	159544
390	167748	167780
392	189740	180004
394	212060	191540
396	231612	202124
398	248404	212712
400	266232	223296
402	284224	236188
404	308716	253368
406	354208	270548
408	422320	287356
410	466840	303956
412	500200	321344
414	524280	342596
416	521880	363848
418	515520	385680
420	480360	407560
422	431880	429880
424	376236	461200
426	326032	481840
428	283112	500840
430	246072	528600
432	214120	552160
434	165332	552160
436	132820	547040
438	119140	501560
440	102580	413280
442	92780	363240
444	81444	282724
446	76324	237224
448	67044	173320
450	62816	103292
452	58864	62640
454	53552	36170
456	49496	30698.8
458	47496	25886.4
460	44480	23388.8
462	41320	20891.2
464	39807.2	19260.8
466	37073.2	18142.4
468	34870.8	17025.6
470	33209.2	16156.4
472	31620	15310
474	30113.6	15048.4
476	28850.8	14792.8
478	27718	14657.2
480	26629.2	14550
482	25701.6	14881.2
484	25180.4	15212.4
486	24669.6	15543.6
488	24174.8	15898
490	23684.4	16684
492	23086.8	17469.6
494	22457.6	18255.6
496	21850.4	19041.2
498	21260	19891.2
500	20932.8	20862
502	20596.4	21832.8
504	20418	22803.6
506	19946	23774.4
508	19996	24745.2
510	20035.2	25773.6
512	20150.4	26936.8
514	20429.2	28100
516	21001.6	29263.2
518	22509.6	30426.4
520	24202.4	31589.6
522	26450.4	32851.2
524	29269.2	34397.6
526	32496.4	35944
528	35990	37490
530	39956.8	39036.4
532	43876	40584
534	46924	42088
536	49752	43592
538	51712	45092
540	53236	46592
542	53292	48148
544	52096	49708
546	49868	51268
548	46660	52496
550	43016	53412
552	39675.2	54080
554	36815.2	54520
556	34476.8	54540
558	33456	54164
560	32613.2	53788
562	32620	52276
564	33915.6	50572
566	36495.2	48828
568	40172	46948
570	44496	45072
572	49172	43340
574	53308	41716
576	55540	40092
578	54728	38467.6
580	50104	37020
582	43304	35676.4
584	34639.6	34332.8
586	26600.4	32851.6
588	19763.2	31075.2
590	14400.8	28324.4
592	10468.4	25470
594	7678.8	22574.8
596	5683.6	19800
598	4504.4	17058.4
600	3200	14677.2
602	2664	13622.4
604	2128	12567.6
606	1789.2	11513.2
608	1647.6	10477.6
610	1506	9443.6
612	1364.4	8591.2
614	1222.8	7762
616	1110	7344.8
618	1026	6927.2
620	942	6509.6
622	858	6193.2
624	774	5906.8
626	707.6	5620
628	658.8	5366.8
630	610	5148.8
632	561.2	4930.8
634	512.4	4730.8
636	478.8	4602.4
638	460.4	4473.6
640	442	4345.2
642	423.6	4216.8
644	405.2	4088.4
646	390.4	3965.08
648	379.2	3857.6
650	368	3750.12
652	356.8	3642.64
654	345.6	3535.16
656	335.2	3427.68
658	325.6	3320.2
660	319.6	3226.56
662	314	3140.28
664	308.4	3053.96
666	302.8	2967.68
668	298	2881.4
670	294	2795.12
672	290	2708.84
674	285.6	2627.64
676	282	2554.4
678	279.2	2481.16
680	277.6	2407.92
682	276	2334.68
684	274.4	2261.48
686	272.8	2188.24
688	274.4	2115
690	276	2051.96
692	277.6	2000.48
694	279.2	1949.04
696	282	1897.56
698	286	1846.08
700	290	1794.28
702	294	1741
704	298	1687.76
706	302.8	1634.48
708	308.4	1583.52
710	314	1540.48
712	319.6	1497.4
714	325.2	1454.36
716	332	1411.32
718	340	1368.28
720	348	1325.88
722	356	1285.16
724	364	1244.44
726	372.4	1203.68
728	381.2	1152.8
730	390	1102.2
732	398.8	1102.2
734	407.6	1102.2
736	418.8	1101.76
738	432.4	1100.48
740	446	1115.88
742	459.6	1161.64
744	473.2	1207.4
746	487.6	1266.04
748	502.8	1333.24
750	518	1405.24
752	533.2	1515.32
754	548.4	1541.76
756	562	1560.48
758	574	1560.48
760	586	1548.52
762	598	1508.44
764	610	1459.56
766	622.8	1410.52
768	636.4	1361.32
770	650	1311.88
772	663.6	1262.44
774	677.2	1213
776	689.2	1163.56
778	699.6	1114.8
780	710	1075.44
782	720.4	1036.08
784	730.8	996.72
786	740	957.36
788	748	921.8
790	756	890.8
792	764	859.8
794	772	828.8
796	786.4	802.96
798	807.2	782.36
800	816	761.72
802	828	743.84
804	836	737.08
806	844	730.28
808	856	723.52
810	864	717.08
812	872	711.84
814	880	706.6
816	887.2	701.32
818	901.6	696.08
820	916	693.76
822	930.4	693.6
824	944.8	693.48
826	956.4	693.32
828	965.2	693.2
830	974	693.04
832	982.8	692.92
834	991.6	692.76
836	1001.2	692.64
838	1011.6	692.48
840	1022	692.36
842	1032.4	692.2
844	1042.8	691.96
846	1050	691.76
848	1054	691.52
850	1058	691.32
852	1062	691.08
854	1066	690.88
856	1072.8	690.64
858	1082.4	692.44
860	1092	694.32
862	1101.6	696.2
864	1111.2	698.04
866	1118.4	699.92
868	1123.2	701.8
870	1128	705.84
872	1132.8	709.96
874	1137.6	714.08
876	1142.8	718.2
878	1148.4	722.32
880	1154	726.44
882	1159.6	729.84
884	1165.2	733.2
886	1170	736.6
888	1174	739.96
890	1178	743.6
892	1182	747.24
894	1186	750.88
896	1190	754.52
898	1194	758.16
900	1198	761.84
902	1202	765.04
904	1206	767.44
906	1209.2	769.8
908	1211.6	772.16
910	1214	774.56
912	1216.4	776.92
914	1218.8	778.4
916	1220.8	778.04
918	1222.4	777.72
920	1224	777.36
922	1225.6	777.04
924	1227.2	776.64
926	1226.8	772.36
928	1224.4	768.08
930	1222	763.84
932	1219.6	752.28
934	1217.2	737.56
936	1215.6	722.88
938	1214.8	708.16
940	1214	693.44
942	1213.2	678.72
944	1212.4	660.52
946	1210.4	641.08
948	1207.2	621.64
950	1204	602.24
952	1200.8	583.4
954	1197.6	568.92
956	1194	554.48
958	1190	540.04
960	1186	525.56
962	1182	511.12
964	1178	495.36
966	1173.2	473.32
968	1167.6	451.32
970	1162	429.32
972	1156.4	415.28
974	1150.8	402.28
976	1144	389.288
978	1136	374.944
980	1128	359.656
982	1120	344.372
984	1112	329.084
986	1102.4	313.796
988	1091.2	298.508
990	1080	283.22
992	1068.8	267.932
994	1057.6	252.648
996	1046.4	237.36
998	1035.2	222.072
1000	1024	206.784
];

function epsilon = moaveni
%% From:
% J.M. Schmitt, "Optical Measurement of Blood Oxygenation by Implantable Telemetry," Technical Report	G558-15, Stanford."
% M.K. Moaveni, "A Multiple Scattering Field Theory Applied to Whole Blood," Ph.D. dissertation, Dept. of Electrical Engineering, University of Washington, 1970.
% lambda	HbO2	Hb	
% nm	cm-1/M	cm-1/M	
epsilon = [
630	680	4280	
640	440	3640	
650	380	3420	
660	320	3200	
670	320	3080	
680	320	2960	
690	280	2560	
700	320	2160	
710	340	1840	
720	360	1520	
730	400	1500	
740	440	1520	
750	520	1620	
760	600	1720	
770	660	1420	
780	720	1120	
790	760	1020	
800	800	920	
810	860	880	
820	920	840	
830	980	840	
840	1040	840	
850	1060	800	
860	1080	840	
870	1120	840	
880	1160	840	
890	1180	860	
900	1200	880	
910	1220	920	
920	1240	880	
930	1240	800	
940	1200	800	
950	1200	720	
];

function epsilon = takatani
%% From:
% S. Takatani and M. D. Graham, "Theoretical analysis of diffuse reflectance from a two-layer tissue model," IEEE Trans. Biomed. Eng., BME-26, 656--664, (1987).
% lambda	HbO2	Hb	
% nm	cm-1/M	cm-1/M	
epsilon = [
450	68000	58000
460	45040	20600
480	27360	13360
500	20200	16360
507	19240	19240
510	19040	20000
520	23520	25080
522	25680	25680
540	57080	41120
542	57480	44000
549	49840	49840
555	36000	52160
560	33880	50160
569	45080	45080
577	61480	36800
579	54920	35440
586	28920	28920
600	3200	14600
605	1860	9496
615	1152	5776
625	732	4400
635	488	3796
645	396	3436
655	340	3244
665	292	3156
675	288	3028
685	272	2796
695	280	2424
705	300	1988
715	328	1628
725	368	1464
735	412	1464
745	480	1616
755	556	1756
765	616	1640
775	684	1340
785	736	1040
795	776	964
805	880	896
815	880	880
825	952	832
835	996	820
845	1048	820
855	1068	820
865	1116	820
875	1140	848
885	1168	832
895	1188	884
905	1208	896
915	1220	924
925	1228	860
935	1216	848
945	1212	756
955	1196	704
965	1176	616
975	1148	552
985	1108	424
995	1052	372
];

function graph(epsilon)
	close all
	plot(epsilon(:,1),epsilon(:,2),'r-','LineWidth',2)
	hold on
	plot(epsilon(:,1),epsilon(:,3),'b-','LineWidth',2)
	
	axis square;							% publication-quality
	box off;								% publication-quality
	set(gca,'TickDir','out','TickLength',[0.005 0.025],...
		'XTick',650:50:900,'YTick',500:500:3500,...
		'FontSize',15,'FontAngle','Italic','FontName','Helvetica'); % publication-quality
	xlabel('Wavelength (nm)','FontSize',15);		% always provide an label on the x-axis
	ylabel('Molar extinction coefficient  \epsilon (cm^{-1}M^{-1})','FontSize',15);	% and on the y-axis
	axis([600 950 200 4000]);						% set axis limits, this can be maximally between -90 and +90 deg
	title('Absorption spectra of hemoglobin'); % Provide all necessary information
	legend('oxyhemoglobin','deoxyhemoglobin');
	
	try
	nicegraph;
	savegraph(mfilename,'eps');
	catch
		disp('Why don''t you try out the Biofysica Toolbox @ Gitlab.ru.nl');
	end

